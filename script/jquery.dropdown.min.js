!function(e){e.fn.DropDown=function(t){var t=e.extend({Type:"Single",AllText:"All items",NoneText:"Please Select",ShowHeader:!1,ItemClass:null,HideSource:!0,NumSelectedText:"items selected"},t);e(this).attr("multiple")&&(t.Type="Multi"),this.each(function(){function l(t){var l='<span id="textmeasurewidth">'+t+"</span>";e("body").append(l);var n=e("#textmeasurewidth").width();return e("#textmeasurewidth").remove(),n}function n(){return a.find(":selected")}function d(){u=n(a),h=u.length;var i="";switch(u.length){case 0:i=t.NoneText;break;case 1:i=u.text();break;default:if(u.length!=s.length){u.each(function(){i+=e(this).text()+", "}),i=i.substr(0,i.length-2),l(i)>=a.width()+48&&(i=h+" "+t.NumSelectedText);break}i=t.AllText}p.find("dt").html(i+c)}var a=e(this),c='<span class="caret"></span>',o=a.attr("name")+"option_",s=e("option",a),u=n(a),h=u.length,p=e("<dl></dl>").addClass("dropdown").addClass("Single"==t.Type?"singleselect":"multiselect"),r=e("<dt>"+c+t.NoneText+"</dt>");selectoptions="<dd><ul>",i=0,t.ShowHeader&&(selectoptions+='<li><div class="dropdownHeader"><button class="DropDownSelectAll">Select All</button><button class="DropDownDeSelectAll">Deselect All</button></div></li>'),s.each(function(){selectoptions+="<li "+(null===t.ItemClass?"":'class="'+t.ItemClass+'"')+">","Single"==t.Type?selectoptions+='<label data-value="'+e(this).val()+'">'+e(this).text()+"</label>":(selectoptions+='<input type="checkbox" id="'+o+i+'" value="'+e(this).val()+'" ',selectoptions+='><label for="'+o+i+'" data-value="'+e(this).val()+'"><span></span>'+e(this).text()+"</label>"),selectoptions+="</li>",i++}),selectoptions+="</ul></dd>",p.append(r).append(selectoptions),h>0&&"Multi"==t.Type&&u.each(function(){var t=e(this).val();p.find("input:checkbox[value='"+t+"']").attr("checked",!0)});var f=a.width(),v=l(t.AllText);v>f&&(f=v),v=l(t.NoneText),v>f&&(f=v),"Multi"==t.Type&&(v=l(s.length+" "+t.NumSelectedText),v>f&&(f=v)),f+=48,p.width(f),p.find("ul").width(f),a.after(p),t.HideSource&&a.hide(),MenuEle=p.find("ul"),p.find("dt").click(function(){e(".dropdown dd ul:visible").hide(),p.find("ul").hide().toggle()}),"Single"==t.Type?p.find("li label, li input:checkbox").click(function(){a.val(e(this).attr("data-value")),d(),p.find("ul").hide()}):(p.find("li input:checkbox").change(function(){var t=e(this).parent().find("input").attr("checked");t?a.find("option[value='"+e(this).val()+"']").attr("selected",!0):a.find("option[value='"+e(this).val()+"']").attr("selected",!1),d()}),t.ShowHeader&&(p.find("ul .DropDownSelectAll").click(function(e){e.preventDefault(),p.find("ul input:checkbox").attr("checked",!0),a.find("option").attr("selected",!0),d()}),p.find("ul .DropDownDeSelectAll").click(function(e){e.preventDefault(),p.find("ul input:checkbox").attr("checked",!1),a.find("option").attr("selected",!1),d()}))),d()}),e(document).click(function(t){e(t.target).closest(".dropdown").length||(e(".dropdown dd ul").hide(),MenuEle.hide())})}}(jQuery);