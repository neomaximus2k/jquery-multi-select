!function(e){e.fn.DropDown=function(t){var t=e.extend({Type:"Single",AllText:"All items",NoneText:"Please Select",ShowHeader:!1,ItemClass:null,HideSource:!0,NumSelectedText:"items selected"},t);e(this).attr("multiple")&&(t.Type="Multi"),this.each(function(){function l(t){var l='<span id="textmeasurewidth">'+t+"</span>";e("body").append(l);var n=e("#textmeasurewidth").width();return e("#textmeasurewidth").remove(),n}function n(){return console.log("_getSelected = "+c.find(":selected").length),c.find(":selected")}function o(){u=n(c),h=u.length;var i="";switch(u.length){case 0:i=t.NoneText;break;case 1:i=u.text();break;default:if(console.log(u),u.length!=s.length){u.each(function(){i+=e(this).text()+", "}),i=i.substr(0,i.length-2),console.log("WIDTH: "+l(i)+" >= "+(c.width()+48)),l(i)>=c.width()+48&&(i=h+" "+t.NumSelectedText);break}i=t.AllText}p.find("dt").html(i+d)}var c=e(this),d='<span class="caret"></span>',a=c.attr("name")+"option_",s=e("option",c),u=n(c),h=u.length,p=e("<dl></dl>").addClass("dropdown").addClass("Single"==t.Type?"singleselect":"multiselect"),r=e("<dt>"+d+t.NoneText+"</dt>");selectoptions="<dd><ul>",i=0,t.ShowHeader&&(selectoptions+='<li><div class="dropdownHeader"><button class="DropDownSelectAll">Select All</button><button class="DropDownDeSelectAll">Deselect All</button></div></li>'),s.each(function(){selectoptions+="<li "+(null===t.ItemClass?"":'class="'+t.ItemClass+'"')+">","Single"==t.Type?selectoptions+='<label data-value="'+e(this).val()+'">'+e(this).text()+"</label>":(selectoptions+='<input type="checkbox" id="'+a+i+'" value="'+e(this).val()+'" ',selectoptions+='><label for="'+a+i+'" data-value="'+e(this).val()+'"><span></span>'+e(this).text()+"</label>"),selectoptions+="</li>",i++}),selectoptions+="</ul></dd>",p.append(r).append(selectoptions),h>0&&"Multi"==t.Type&&u.each(function(){var t=e(this).val();p.find("input:checkbox[value='"+t+"']").attr("checked",!0)});var f=c.width(),v=l(t.AllText);v>f&&(f=v),v=l(t.NoneText),v>f&&(f=v),"Multi"==t.Type&&(v=l(s.length+" "+t.NumSelectedText),v>f&&(f=v)),f+=48,p.width(f),p.find("ul").width(f),c.after(p),t.HideSource&&c.hide(),MenuEle=p.find("ul"),p.find("dt").click(function(){e(".dropdown dd ul:visible").hide(),p.find("ul").hide().toggle()}),"Single"==t.Type?p.find("li label, li input:checkbox").click(function(){c.val(e(this).attr("data-value")),o(),p.find("ul").hide()}):(p.find("li input:checkbox").change(function(){var t=e(this).parent().find("input").attr("checked");console.log(t),t?c.find("option[value='"+e(this).val()+"']").attr("selected",!0):c.find("option[value='"+e(this).val()+"']").attr("selected",!1),console.log("option[value='"+e(this).val()+"']"),o()}),t.ShowHeader&&(MenuEle.find(".DropDownSelectAll").click(function(t){t.preventDefault(),MenuEle.find("input:checkbox").each(function(){console.log("--"+e(this).attr("checked")),e(this).attr("checked",!0),console.log("=="+e(this).attr("checked"))}),c.find("option").attr("selected",!0),o()}),MenuEle.find(".DropDownDeSelectAll").click(function(e){e.preventDefault(),MenuEle.find("input:checkbox").attr("checked",!1),c.find("option").attr("selected",!1),p.find("dt").html(t.NoneText+d)}))),o()}),e(document).click(function(t){e(t.target).closest(".dropdown").length||(e(".dropdown dd ul").hide(),MenuEle.hide())})}}(jQuery);